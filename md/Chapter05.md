# [Chapter 05](https://livebook.manning.com/book/modern-java-in-action/chapter-5/)

## 스트림 활용

### 5.1 필터링

#### 5.1.1 프레디케이트로 필터링

- filter
  - filter 메서드는 프레디케이트(불리언을 반환하는 함수)를 인수로 받아서 프레디케이트와 일치하는 모든 요소를 포함하는 스트림을 반환한다.
- ![그림 5-1 프레디케이트로 스트림 필터링하기](https://drek4537l1klr.cloudfront.net/urma2/Figures/05fig01_alt.jpg)

#### 5.1.2 고유요소 필터링

- distinct
  - 고유 요소로 이루어진 스트림을 반환
  - 고유 여부는 스트림에서 만든 객체의 hashCode, equals로 결정된다
- ![그림 5-2 스트림에서 고유 요소만 필터링](https://drek4537l1klr.cloudfront.net/urma2/Figures/05fig02_alt.jpg)

### 5.2 스트림 슬라이싱

#### 5.2.1 프레디케이트를 이용한 슬라이싱

- 자바 9은 스트림의 요소를 효과적으로 선택할 수 있도록 `takeWhile`, `dropWhile` 두 가지 새로운 메서드를 지원한다.

##### TAKEWHILE

- 리스트가 이미 정렬되어 있다는 사실을 이용해 320칼로리보다 크거나 같은 요리가 나왔을 때 반복 작업을 중단 할 수 있다.
- `takeWhile`을 이용하면 무한스트림을 포함한 모든 스트림에 프레디 케이트를 적용해 스트림을 슬라이스할 수 있다.

##### DROPWHILE

- `dropWhile`은 `takeWhile`과 정반대의 작업을 수행
- `dropWhile`은 프레디케이트가 처음으로 거짓이 되는 지점까지 발견된 요소를 버린다. 프레디케이트가 거짓이 되면 그 지점에서 작업을 중단하고 남은 모든 요소를 반환한다.
- 무한한 남은 요소를 가진 무한 스트림에서도 동작한다

#### 5.2.2 스트림 축소

- 스트림은 주어진 값 이하의 크기를 갖는 새로운 스트림을 반환하는 `limit(n)` 메서드를 지원한다.
- 스트림이 정렬되어 있으면 최대 요소 `n`개를 반환할 수 있다.
  - 정렬되지 않은 스트림 (예를 들면 소스가 `Set`)에도 `limit`를 사용할 수 있다.
  - 소스가 정렬되어 있지 않았다면 `limit`의 결과도 정렬되지 않은 상태로 반환된다.
- ![그림 5-3 스트림 연결](https://drek4537l1klr.cloudfront.net/urma2/Figures/05fig03_alt.jpg)

#### 5.2.3 요소 건너뛰기

- 스트림은 처음 `n`개 요소를 제외한 스트림을 반환하는 `skip(n)` 메서드를 지원한다.
- `n`개 이하의 요소를 포함하는 스트림에 `skip(n)`을 호출하면 빈 스트림이 반환된다. `limit(n)`과 `skip(n)` 은 상호 보완적인 연산을 수행한다.
- ![그림 5-4 스트림의 요소 건너뛰기](https://drek4537l1klr.cloudfront.net/urma2/Figures/05fig04_alt.jpg)

### 5.3 매핑

#### 5.3.1 스트림의 각 요소에 함수 적용하기

- 스트림은 함수를 인수로 받는 `map` 메서드를 지원한다.
- 인수로 제공된 함수는 각 요소에 적용되 며 함수를 적용한 결과가 새로운 요소로 매핑된다
- 이 과정은 기존의 값을 '고친다(modify)'라는 개념보다는 '새로운 버전을 만든다'라는 개념에 가까우므로 '변환(transforming)'에 가까운 '매핑(mapping)' 이라는 단어를 사용한다.

#### 5.3.2 스트림 평면화

- `map`을 응용해서 리 스트에서 고유 문자로 이루어진 리스트를 반환해보자
- ![그림 5-5 map을 이용해서 단어 리스트에서 고유 문자를 찾는 데 실패한 사례](https://drek4537l1klr.cloudfront.net/urma2/Figures/05fig05_alt.jpg)

##### map과 Arrays.stream 활용

##### flatMap 사용

- `flatMap`은 각 배열을 스트림이 아니라 스트림의 콘텐츠로 매핑한다.
- 즉, `map(Arrays::stream)` 과 달리 `flatMap`은 하나의 평면화된 스트림을 반환한다.
- 스트림의 각 값을 다른 스트림으로 만든 다음에 모든 스트림을 하나의 스트림으로 연결하는 기능을 수행한다.
- ![그림 5-6 flatMap을 이용해서 단어 리스트에서 고유 문자 찾기](https://drek4537l1klr.cloudfront.net/urma2/Figures/05fig06_alt.jpg)
- 10장에서는 `null`을 확인하는 새로운 라이브러리 클래스인 `Optional`이라는 고급 자바 8 패턴 을 설명하면서 `flatMap`을 다시 설명한다.

### 5.4 검색과 매칭

#### 5.4.1 프레디케이트가 적어도 한 요소와 일치하는지 확인

#### 5.4.2 프레디케이트가 모든 요소와 일치하는지 검사

##### NONEMATCH

#### 쇼트서킹 평가

> 때로는 전체 스트림을 처리하지 않았더라도 결과를 반환할 수 있다.
> 예를 들어 여러 `and` 연산으로 연결된 커다란 불리언 표현식을 평가한다고 가정하자.
> 표현식에서 하나라도 거짓이라는 결 과가 나오면 나머지 표현식의 결과와 상관없이 전체 결과도 거짓이 된다.
> 이러한 상황을 쇼트 서킷이라고 부른다. `allMatch`, `noneMatch`, `findFirst`, `findAny` 등의 연산은 모든 스트림의 요소를 처리하지 않고도 결과를 반환할수 있다.
> 원하는 요소를찾았으면 즉시 결과를 반환할수 있다. 마찬가지로 스트림의 모든 요소를 처리할 필요 없이 주어진 크기의 스트림을 생성하는 `limit`도 쇼트서킷 연산이다.
> 특히 무한한 요소를 가진 스트림을 유한한 크기로 줄일 수 있는 유용한 연산이다. 5.7절에서 무한 스트림의 예제를 살펴본다.